.rn '' }`
''' $RCSfile$$Revision$$Date$
'''
''' $Log$
'''
.de Sh
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp
.if t .sp .5v
.if n .sp
..
.de Ip
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.de Vb
.ft CW
.nf
.ne \\$1
..
.de Ve
.ft R

.fi
..
'''
'''
'''     Set up \*(-- to give an unbreakable dash;
'''     string Tr holds user defined translation string.
'''     Bell System Logo is used as a dummy character.
'''
.tr \(*W-|\(bv\*(Tr
.ie n \{\
.ds -- \(*W-
.ds PI pi
.if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\" diablo 12 pitch
.ds L" ""
.ds R" ""
.ds L' '
.ds R' '
'br\}
.el\{\
.ds -- \(em\|
.tr \*(Tr
.ds L" ``
.ds R" ''
.ds L' `
.ds R' '
.ds PI \(*p
'br\}
.\"	If the F register is turned on, we'll generate
.\"	index entries out stderr for the following things:
.\"		TH	Title 
.\"		SH	Header
.\"		Sh	Subsection 
.\"		Ip	Item
.\"		X<>	Xref  (embedded
.\"	Of course, you have to process the output yourself
.\"	in some meaninful fashion.
.if \nF \{
.de IX
.tm Index:\\$1\t\\n%\t"\\$2"
..
.nr % 0
.rr F
.\}
.TH SelfLoader 3 "perl 5.003, patch 05" "16/Aug/96" "Perl Programmers Reference Guide"
.IX Title "SelfLoader 3"
.UC
.IX Name "SelfLoader - load functions only on demand"
.if n .hy 0
.if n .na
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.de CQ          \" put $1 in typewriter font
.ft CW
'if n "\c
'if t \\&\\$1\c
'if n \\&\\$1\c
'if n \&"
\\&\\$2 \\$3 \\$4 \\$5 \\$6 \\$7
'.ft R
..
.\" @(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2
.	\" AM - accent mark definitions
.bd B 3
.	\" fudge factors for nroff and troff
.if n \{\
.	ds #H 0
.	ds #V .8m
.	ds #F .3m
.	ds #[ \f1
.	ds #] \fP
.\}
.if t \{\
.	ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.	ds #V .6m
.	ds #F 0
.	ds #[ \&
.	ds #] \&
.\}
.	\" simple accents for nroff and troff
.if n \{\
.	ds ' \&
.	ds ` \&
.	ds ^ \&
.	ds , \&
.	ds ~ ~
.	ds ? ?
.	ds ! !
.	ds /
.	ds q
.\}
.if t \{\
.	ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.	ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.	ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.	ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.	ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.	ds ? \s-2c\h'-\w'c'u*7/10'\u\h'\*(#H'\zi\d\s+2\h'\w'c'u*8/10'
.	ds ! \s-2\(or\s+2\h'-\w'\(or'u'\v'-.8m'.\v'.8m'
.	ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.	ds q o\h'-\w'o'u*8/10'\s-4\v'.4m'\z\(*i\v'-.4m'\s+4\h'\w'o'u*8/10'
.\}
.	\" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds v \\k:\h'-(\\n(.wu*9/10-\*(#H)'\v'-\*(#V'\*(#[\s-4v\s0\v'\*(#V'\h'|\\n:u'\*(#]
.ds _ \\k:\h'-(\\n(.wu*9/10-\*(#H+(\*(#F*2/3))'\v'-.4m'\z\(hy\v'.4m'\h'|\\n:u'
.ds . \\k:\h'-(\\n(.wu*8/10)'\v'\*(#V*4/10'\z.\v'-\*(#V*4/10'\h'|\\n:u'
.ds 3 \*(#[\v'.2m'\s-2\&3\s0\v'-.2m'\*(#]
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.ds oe o\h'-(\w'o'u*4/10)'e
.ds Oe O\h'-(\w'O'u*4/10)'E
.	\" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.	\" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.	ds : e
.	ds 8 ss
.	ds v \h'-1'\o'\(aa\(ga'
.	ds _ \h'-1'^
.	ds . \h'-1'.
.	ds 3 3
.	ds o a
.	ds d- d\h'-1'\(ga
.	ds D- D\h'-1'\(hy
.	ds th \o'bp'
.	ds Th \o'LP'
.	ds ae ae
.	ds Ae AE
.	ds oe oe
.	ds Oe OE
.\}
.rm #[ #] #H #V #F C
.SH "NAME"
.IX Header "NAME"
SelfLoader \- load functions only on demand
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.PP
.Vb 7
\&    package FOOBAR;
\&    use SelfLoader;
\&    
\&    ... (initializing code)
\&    
\&    __DATA__
\&    sub {....
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
This module tells its users that functions in the FOOBAR package are to be
autoloaded from after the \f(CW__DATA__\fR token.  See also
the section on \fIAutoloading\fR in the \fIperlsub\fR manpage.
.Sh "The _\|_DATA_\|_ token"
.IX Subsection "The _\|_DATA_\|_ token"
The \f(CW__DATA__\fR token tells the perl compiler that the perl code
for compilation is finished. Everything after the \f(CW__DATA__\fR token
is available for reading via the filehandle \s-1FOOBAR::DATA\s0,
where \s-1FOOBAR\s0 is the name of the current package when the \f(CW__DATA__\fR
token is reached. This works just the same as \f(CW__END__\fR does in
package \*(L'main\*(R', but for other modules data after \f(CW__END__\fR is not
automatically retreivable , whereas data after \f(CW__DATA__\fR is.
The \f(CW__DATA__\fR token is not recognized in versions of perl prior to
5.001m.
.PP
Note that it is possible to have \f(CW__DATA__\fR tokens in the same package
in multiple files, and that the last \f(CW__DATA__\fR token in a given
package that is encountered by the compiler is the one accessible
by the filehandle. This also applies to \f(CW__END__\fR and main, i.e. if
the \*(L'main\*(R' program has an \f(CW__END__\fR, but a module \*(L'require'd (_not_ \*(L'use'd)
by that program has a \*(L'package main;\*(R' declaration followed by an \*(L'\f(CW__DATA__\fR\*(R',
then the \f(CWDATA\fR filehandle is set to access the data after the \f(CW__DATA__\fR
in the module, _not_ the data after the \f(CW__END__\fR token in the \*(L'main\*(R'
program, since the compiler encounters the \*(L'require'd file later.
.Sh "SelfLoader autoloading"
.IX Subsection "SelfLoader autoloading"
The \fBSelfLoader\fR works by the user placing the \f(CW__DATA__\fR
token \fIafter\fR perl code which needs to be compiled and
run at \*(L'require\*(R' time, but \fIbefore\fR subroutine declarations
that can be loaded in later \- usually because they may never
be called.
.PP
The \fBSelfLoader\fR will read from the \s-1FOOBAR::DATA\s0 filehandle to
load in the data after \f(CW__DATA__\fR, and load in any subroutine
when it is called. The costs are the one-time parsing of the
data after \f(CW__DATA__\fR, and a load delay for the _first_
call of any autoloaded function. The benefits (hopefully)
are a speeded up compilation phase, with no need to load
functions which are never used.
.PP
The \fBSelfLoader\fR will stop reading from \f(CW__DATA__\fR if
it encounters the \f(CW__END__\fR token \- just as you would expect.
If the \f(CW__END__\fR token is present, and is followed by the
token \s-1DATA\s0, then the \fBSelfLoader\fR leaves the \s-1FOOBAR::DATA\s0
filehandle open on the line after that token.
.PP
The \fBSelfLoader\fR exports the \f(CWAUTOLOAD\fR subroutine to the
package using the \fBSelfLoader\fR, and this loads the called
subroutine when it is first called.
.PP
There is no advantage to putting subroutines which will _always_
be called after the \f(CW__DATA__\fR token.
.Sh "Autoloading and package lexicals"
.IX Subsection "Autoloading and package lexicals"
A \*(L'my \f(CW$pack_lexical\fR\*(R' statement makes the variable \f(CW$pack_lexical\fR
local _only_ to the file up to the \f(CW__DATA__\fR token. Subroutines
declared elsewhere _cannot_ see these types of variables,
just as if you declared subroutines in the package but in another
file, they cannot see these variables.
.PP
So specifically, autoloaded functions cannot see package
lexicals (this applies to both the \fBSelfLoader\fR and the Autoloader).
The \f(CWvars\fR pragma provides an alternative to defining package-level
globals that will be visible to autoloaded routines. See the documentation
on \fBvars\fR in the pragma section of the \fIperlmod\fR manpage.
.Sh "SelfLoader and AutoLoader"
.IX Subsection "SelfLoader and AutoLoader"
The \fBSelfLoader\fR can replace the AutoLoader \- just change \*(L'use AutoLoader\*(R'
to \*(L'use SelfLoader\*(R' (though note that the \fBSelfLoader\fR exports
the \s-1AUTOLOAD\s0 function \- but if you have your own \s-1AUTOLOAD\s0 and
are using the AutoLoader too, you probably know what you're doing),
and the \f(CW__END__\fR token to \f(CW__DATA__\fR. You will need perl version 5.001m
or later to use this (version 5.001 with all patches up to patch m).
.PP
There is no need to inherit from the \fBSelfLoader\fR.
.PP
The \fBSelfLoader\fR works similarly to the AutoLoader, but picks up the
subs from after the \f(CW__DATA__\fR instead of in the \*(L'lib/auto\*(R' directory.
There is a maintainance gain in not needing to run AutoSplit on the module
at installation, and a runtime gain in not needing to keep opening and
closing files to load subs. There is a runtime loss in needing
to parse the code after the \f(CW__DATA__\fR. Details of the \fBAutoLoader\fR and
another view of these distinctions can be found in that module's
documentation.
.Sh "_\|_DATA_\|_, _\|_END_\|_, and the \s-1FOOBAR::DATA\s0 filehandle."
.IX Subsection "_\|_DATA_\|_, _\|_END_\|_, and the \s-1FOOBAR::DATA\s0 filehandle."
This section is only relevant if you want to use
the \f(CWFOOBAR::DATA\fR together with the \fBSelfLoader\fR.
.PP
Data after the \f(CW__DATA__\fR token in a module is read using the
\s-1FOOBAR::DATA\s0 filehandle. \f(CW__END__\fR can still be used to denote the end
of the \f(CW__DATA__\fR section if followed by the token \s-1DATA\s0 \- this is supported
by the \fBSelfLoader\fR. The \f(CWFOOBAR::DATA\fR filehandle is left open if an
\f(CW__END__\fR followed by a \s-1DATA\s0 is found, with the filehandle positioned at
the start of the line after the \f(CW__END__\fR token. If no \f(CW__END__\fR token is
present, or an \f(CW__END__\fR token with no \s-1DATA\s0 token on the same line, then
the filehandle is closed.
.PP
The \fBSelfLoader\fR reads from wherever the current
position of the \f(CWFOOBAR::DATA\fR filehandle is, until the
\s-1EOF\s0 or \f(CW__END__\fR. This means that if you want to use
that filehandle (and \s-1ONLY\s0 if you want to), you should either
.PP
1. Put all your subroutine declarations immediately after
the \f(CW__DATA__\fR token and put your own data after those
declarations, using the \f(CW__END__\fR token to mark the end
of subroutine declarations. You must also ensure that the \fBSelfLoader\fR
reads first by  calling \*(L'SelfLoader->\fIload_stubs()\fR;\*(R', or by using a
function which is selfloaded;
.PP
or
.PP
2. You should read the \f(CWFOOBAR::DATA\fR filehandle first, leaving
the handle open and positioned at the first line of subroutine
declarations.
.PP
You could conceivably do both.
.Sh "Classes and inherited methods."
.IX Subsection "Classes and inherited methods."
For modules which are not classes, this section is not relevant.
This section is only relevant if you have methods which could
be inherited.
.PP
A subroutine stub (or forward declaration) looks like
.PP
.Vb 1
\&  sub stub;
.Ve
i.e. it is a subroutine declaration without the body of the
subroutine. For modules which are not classes, there is no real
need for stubs as far as autoloading is concerned.
.PP
For modules which \s-1ARE\s0 classes, and need to handle inherited methods,
stubs are needed to ensure that the method inheritance mechanism works
properly. You can load the stubs into the module at \*(L'require\*(R' time, by
adding the statement \*(L'SelfLoader->\fIload_stubs()\fR;\*(R' to the module to do
this.
.PP
The alternative is to put the stubs in before the \f(CW__DATA__\fR token \s-1BEFORE\s0
releasing the module, and for this purpose the \f(CWDevel::SelfStubber\fR
module is available.  However this does require the extra step of ensuring
that the stubs are in the module. If this is done I strongly recommend
that this is done \s-1BEFORE\s0 releasing the module \- it should \s-1NOT\s0 be done
at install time in general.
.SH "Multiple packages and fully qualified subroutine names"
.IX Header "Multiple packages and fully qualified subroutine names"
Subroutines in multiple packages within the same file are supported \- but you
should note that this requires exporting the \f(CWSelfLoader::AUTOLOAD\fR to
every package which requires it. This is done automatically by the
\fBSelfLoader\fR when it first loads the subs into the cache, but you should
really specify it in the initialization before the \f(CW__DATA__\fR by putting
a \*(L'use SelfLoader\*(R' statement in each package.
.PP
Fully qualified subroutine names are also supported. For example,
.PP
.Vb 4
\&   __DATA__
\&   sub foo::bar {23}
\&   package baz;
\&   sub dob {32}
.Ve
will all be loaded correctly by the \fBSelfLoader\fR, and the \fBSelfLoader\fR
will ensure that the packages \*(L'foo\*(R' and \*(L'baz\*(R' correctly have the
\fBSelfLoader\fR \f(CWAUTOLOAD\fR method when the data after \f(CW__DATA__\fR is first
parsed.

.rn }` ''
